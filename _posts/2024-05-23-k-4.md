---
title: "[Kubernetes]-도커&쿠버네티스 4일차"
excerpt: "쿠버네티스 업데이트 & 모니터링"

categories:
  - Kubernetes
tags:
  - [kubernetes, docker]

permalink: /kubernetes/k-4/

toc: true
toc_sticky: true

date: 2024-05-23
last_modified_at: 2024-05-23
---
# 쿠버네티스 4일차

### Kubernetes Architecture

![kube](https://github.com/yblmmen/gatsby.github.io/assets/161982180/39f86e39-0c15-432a-8295-077f0bb40148)
![kube2](https://github.com/yblmmen/gatsby.github.io/assets/161982180/b35ddec4-25a0-48b2-a5fb-8f388d8b3d21)



### 1. namespace

- namespace Archetecture
![namespace](https://github.com/yblmmen/gatsby.github.io/assets/161982180/af4adf56-5450-414f-a86d-aa6cfdde0062)

#### namespace의 기능
  - 자원 분리 및 접근제어 기능

#### namespace 실습

```
<Kubernetes 기본 명령어>

# mkdir workspace && cd $_
# kubectl api-resources    // 버전,  shortnames 정보등을 볼수 있음
  - shortname -> 예) kubectl get no
  - pod(task) = container + volume + side car (side car: container 감시 기능)

# kubectl [명령어] [유형] [이름] [옵션]
# kubectl get node
# kubectl run nginx-pod --image=nginx # pending > ContainerCreating > Running
# kubectl get pod
# kubectl get service

// cluster ip 서비스 생성 (클러스터 내 노드와 POD 간 통신 가능한 서비스)
# kubectl expose pod nginx-pod --name clusterip --type=ClusterIP --port 80

// nodeport & Loadbalancer (외부에서 접속 가능하게 해줌), 노드포트와 cluser ip는 동시에 설정할 필요없음
// NodePort를 사용하면 포트당 하나의 서비스를 사용하며, 30000-32767 범위 내의 포트를 사용 가능하다.
# kubectl expose pod nginx-pod --name nodeport --type=NodePort --port 80     // type 설정은 반드시 pascal

// external ip : 노드들의 private ip
// GCP가 외부 IP를 Private-ip 로 NAT시켜줌
# kubectl expose pod nginx-pod --name loadbalancer --type=LoadBalancer --external-ip 10.178.0.7 --port 80
# kubectl get pod
# kubectl get service

// pod 내 bash 접속
# kubectl exec -it nginx-pod -- bash


# kubectl cp html nginx-pod:/usr/share/nginx
# kubectl get all

// 동일 네임스페이스 내에서 delete 가능
# kubectl delete svc --all
# kubectl delete pod nginx-pod
# kubectl delete pod,svc --all      // 주의사항: , 사이에 절대 스페이스 넣지 말것
# kubectl delete pod <pod> --grace-period=0 --force pod   // pod 삭제시 지연없이 강제 삭제 


# kubectl options
# kubectl api-resources
# kubectl get nodes -o wide
# kubectl get nodes -o wide --no-headers
# kubectl get nodes -o wide --no-headers | awk '{print $6}'
# kubectl create deployment nginx-app --replicas=2 --image=nginx
# kubectl get deployments.apps
# kubectl get replicasets.apps
# kubectl get pods
# kubectl expose deployment nginx-app --name clusterip-app --type=ClusterIP --port 80
# kubectl expose deployment nginx-app --name nodeport-app --type=NodePort --port 80

# kubectl expose deployment nginx-app --name loadbalancer-app --type=LoadBalancer --external-ip 192.168.0.29 --port 80
# kubectl get service
# kubectl scale deployment nginx-app --replicas=4
# kubectl get pods
# kubectl scale deployment nginx-app --replicas=2
# kubectl get pods
# kubectl delete deployments.apps nginx-app
# kubectl delete service --all

--- Kubernetes 네임스페이스
# kubectl get namespaces
# kubectl config get-contexts kubernetes-admin@kubernetes
# kubectl config set-context kubernetes-admin@kubernetes --namespace=kube-system
# kubectl config get-contexts kubernetes-admin@kubernetes
# kubectl config set-context kubernetes-admin@kubernetes --namespace=default
# kubectl create namespace test-namespace
# kubectl get namespace
# kubectl config set-context kubernetes-admin@kubernetes --namespace=test-namespace
# kubectl config set-context kubernetes-admin@kubernetes --namespace=default
```

- 노드포트 실습
  - 참고 [쿠버네티스 치트시트](https://kubernetes.io/ko/docs/reference/kubectl/cheatsheet/)  
```
// kube-proxy 가 접속 연결수행

# master1 : 34.47.77.56  /  private ip : 10.178.0.7
# worker1 : 34.47.75.9   /  private ip : 10.178.0.8
# worker2 : 34.47.89.46  /  private ip : 10.178.0.9

# nodeport: 31718
http://34.47.77.56:31718/
http://34.47.75.9:31718/
http://34.47.89.46:31718/

# loadbalance : 30348
http://34.47.77.56:30348/
http://34.47.75.9:30348/
http://34.47.89.46:30348/

<실습>
kubectl expose pod nginx-pod --name loadbalancer --type=LoadBalancer --external-ip 10.178.0.7 --port 80
```










 
